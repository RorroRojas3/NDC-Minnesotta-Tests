"use strict";(self.webpackChunktesting_workshop=self.webpackChunktesting_workshop||[]).push([[3538],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(n),h=o,m=d["".concat(c,".").concat(h)]||d[h]||l[h]||i;return n?r.createElement(m,a(a({ref:t},u),{},{components:n})):r.createElement(m,a({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var p=2;p<i;p++)a[p]=n[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},242:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(7462),o=(n(7294),n(3905));const i={description:"Writing assertions for exceptions"},a="Asserting exceptions",s={unversionedId:"unit-testing/deep-dive/asserting-exceptions",id:"unit-testing/deep-dive/asserting-exceptions",title:"Asserting exceptions",description:"Writing assertions for exceptions",source:"@site/docs/unit-testing/deep-dive/asserting-exceptions.md",sourceDirName:"unit-testing/deep-dive",slug:"/unit-testing/deep-dive/asserting-exceptions",permalink:"/unit-testing/deep-dive/asserting-exceptions",draft:!1,tags:[],version:"current",frontMatter:{description:"Writing assertions for exceptions"},sidebar:"docs",previous:{title:"Introducing Mocking",permalink:"/unit-testing/deep-dive/mocking-intro"},next:{title:"Verifying expected calls",permalink:"/unit-testing/deep-dive/verify-calls"}},c={},p=[],u={toc:p};function l(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"asserting-exceptions"},"Asserting exceptions"),(0,o.kt)("p",null,"It is not uncommon for exceptions to be part of our application's logic.\nThis means that we should be unit testing that exceptions are thrown when they should be. "),(0,o.kt)("p",null,"But here is the question. How do we assert that an exception is thrown, when throwing an exception in a test will make it fail?"),(0,o.kt)("p",null,"Let's say that we want to write a test called ",(0,o.kt)("inlineCode",{parentName:"p"},"GetQuoteAsync_ShouldThrowException_WhenSameCurrencyIsUsed")," which ensures that an exception is thrown when the ",(0,o.kt)("inlineCode",{parentName:"p"},"baseCurrency")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"quoteCurrency")," are the same value."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'[Fact]\npublic async Task GetQuoteAsync_ShouldThrowException_WhenSameCurrencyIsUsed()\n{\n    // Arrange\n    var fromCurrency = "GBP";\n    var toCurrency = "GBP";\n    var amount = 100;\n    var expectedRate = new FxRate\n    {\n        FromCurrency = fromCurrency,\n        ToCurrency = toCurrency,\n        TimestampUtc = DateTime.UtcNow,\n        Rate = 1.6m\n    };\n    \n    _ratesRepository.GetRateAsync(fromCurrency, toCurrency)\n        .Returns(expectedRate);\n    \n    // Act\n    var quote = _sut.GetQuoteAsync(fromCurrency, toCurrency, amount);\n}\n')),(0,o.kt)("p",null,"This is as far as our test will go before it failed with a ",(0,o.kt)("inlineCode",{parentName:"p"},"SameCurrencyException"),"."),(0,o.kt)("p",null,"To solve that problem, we need to wrap our ",(0,o.kt)("inlineCode",{parentName:"p"},"Act")," part in an ",(0,o.kt)("inlineCode",{parentName:"p"},"Action"),".\nOnce we do that we can use FluentAssertions' ",(0,o.kt)("inlineCode",{parentName:"p"},"Should().ThrowAsync<ExceptionType>")," extension methods to validate that the right exception was thrown, without failing our test."),(0,o.kt)("p",null,"This will make our Act look like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"// Act\nvar quoteAction = () => _sut.GetQuoteAsync(fromCurrency, toCurrency, amount);\n")),(0,o.kt)("p",null,"And our Assert look like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"// Assert\nawait quoteAction.Should().ThrowAsync<SameCurrencyException>();\n")),(0,o.kt)("p",null,"And now our test will pass \ud83e\udd73! "),(0,o.kt)("p",null,"There is however one thing that we haven't tested and we really should.\nThat's the exception message. We can use the chained ",(0,o.kt)("inlineCode",{parentName:"p"},"WithMessage")," method to achieved that."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'// Assert\nawait quoteAction.Should().ThrowAsync<SameCurrencyException>().WithMessage($"You cannot convert currency {fromCurrency} to itself");\n')))}l.isMDXComponent=!0}}]);