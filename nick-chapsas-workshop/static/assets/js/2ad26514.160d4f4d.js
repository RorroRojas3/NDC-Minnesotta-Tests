"use strict";(self.webpackChunktesting_workshop=self.webpackChunktesting_workshop||[]).push([[4613],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>g});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=o.createContext({}),s=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return o.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(n),g=a,m=u["".concat(c,".").concat(g)]||u[g]||p[g]||r;return n?o.createElement(m,i(i({ref:t},d),{},{components:n})):o.createElement(m,i({ref:t},d))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},572:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var o=n(7462),a=(n(7294),n(3905));const r={description:"What is code coverage and how can we collect it?"},i="Code coverage",l={unversionedId:"unit-testing/deep-dive/code-coverage",id:"unit-testing/deep-dive/code-coverage",title:"Code coverage",description:"What is code coverage and how can we collect it?",source:"@site/docs/unit-testing/deep-dive/code-coverage.md",sourceDirName:"unit-testing/deep-dive",slug:"/unit-testing/deep-dive/code-coverage",permalink:"/unit-testing/deep-dive/code-coverage",draft:!1,tags:[],version:"current",frontMatter:{description:"What is code coverage and how can we collect it?"},sidebar:"docs",previous:{title:"Let's practice TDD",permalink:"/unit-testing/tdd/an-example"},next:{title:"Mutation testing",permalink:"/category/mutation-testing"}},c={},s=[{value:"Definition",id:"definition",level:2},{value:"IDE specific tooling",id:"ide-specific-tooling",level:2},{value:"Generic code coverage collection",id:"generic-code-coverage-collection",level:2},{value:"Excluding items from code coverage",id:"excluding-items-from-code-coverage",level:3},{value:"Generating a site to visualize code coverage",id:"generating-a-site-to-visualize-code-coverage",level:3}],d={toc:s};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,o.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"code-coverage"},"Code coverage"),(0,a.kt)("h2",{id:"definition"},"Definition"),(0,a.kt)("p",null,"The most commonly used way to determine whether the tests we're written are enough and sufficient is code coverage."),(0,a.kt)("p",null,"Code coverage is a software testing metric that determines the number of lines of code that is successfully validated under a test procedure, which in turn, helps in analyzing how comprehensively a software is verified."),(0,a.kt)("p",null,"The common metrics that you might see mentioned in your coverage reports include:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Function coverage"),": how many of the functions defined have been called"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Statement coverage"),": how many of the statements in the program have been executed"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Branches coverage"),": how many of the branches of the control structures (if statements for instance) have been executed"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Condition coverage"),": how many of the boolean sub-expressions have been tested for a true and a false value"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Line coverage"),": how many of lines of source code have been tested")),(0,a.kt)("p",null,"Line coverage is the most common one you will see and it's the one tools default to if they don't specify any other types of coverage by name."),(0,a.kt)("h2",{id:"ide-specific-tooling"},"IDE specific tooling"),(0,a.kt)("p",null,"Several IDEs support code coverage collection as one of their features. So does the IDE that I'm using, JetBrains Rider."),(0,a.kt)("p",null,"Example:\n",(0,a.kt)("img",{src:n(5963).Z,width:"1274",height:"856"})),(0,a.kt)("h2",{id:"generic-code-coverage-collection"},"Generic code coverage collection"),(0,a.kt)("p",null,"It is totally understandable if you want your code coverage collection to be done in a way that is not IDE specific. We can achieve that with a Nuget package and a few dotnet command line tools."),(0,a.kt)("p",null,"The first package we need in our test project is ",(0,a.kt)("inlineCode",{parentName:"p"},"coverlet.collector"),".\nYou can install it either by your IDE's Nuget client or using the command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},"dotnet add package coverlet.collector\n")),(0,a.kt)("p",null,"This package will help us collect the code coverage of our project in a format what we can easily use for multiple purposes."),(0,a.kt)("p",null,"Now let's install the ",(0,a.kt)("inlineCode",{parentName:"p"},"coverlet")," command-line tool."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},"dotnet tool install -g coverlet.console\n")),(0,a.kt)("p",null,"This is a global command that you can access from anywhere in your workstation. To run it against our ",(0,a.kt)("inlineCode",{parentName:"p"},"ForeignExchange.Api.Tests.Unit")," project simply open the terminal in the project repository and run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},'dotnet build\ncoverlet .\\bin\\Debug\\net6.0\\ForeignExchange.Api.Tests.Unit.dll --target "dotnet" --targetargs "test --no-build"\n')),(0,a.kt)("p",null,"You will see the following result in the console:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-markdown"},"+---------------------+--------+--------+--------+\n| Module              | Line   | Branch | Method |\n+---------------------+--------+--------+--------+\n| ForeignExchange.Api | 28.97% | 50%    | 50%    |\n+---------------------+--------+--------+--------+\n\n+---------+--------+--------+--------+\n|         | Line   | Branch | Method |\n+---------+--------+--------+--------+\n| Total   | 28.97% | 50%    | 50%    |\n+---------+--------+--------+--------+\n| Average | 28.97% | 50%    | 50%    |\n+---------+--------+--------+--------+\n")),(0,a.kt)("p",null,"There is also a ",(0,a.kt)("inlineCode",{parentName:"p"},"coverage.json")," file generated, which you can parse and get all that information too.\nThis can be really useful when you're collecting code coverage as part of your Continuous Integration pipeline. "),(0,a.kt)("h3",{id:"excluding-items-from-code-coverage"},"Excluding items from code coverage"),(0,a.kt)("p",null,"You can exclude specific items like classes or methods from code coverage in two ways."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Apply an ",(0,a.kt)("inlineCode",{parentName:"li"},"[ExcludeFromCodeCoverage]")," attribute on the item"),(0,a.kt)("li",{parentName:"ul"},"Append the ",(0,a.kt)("inlineCode",{parentName:"li"},"--exclude")," parameter at the ",(0,a.kt)("inlineCode",{parentName:"li"},"coverlet")," command like this: ",(0,a.kt)("inlineCode",{parentName:"li"},'--exclude "[*]ForeignExchange.Api.Repositories"'))),(0,a.kt)("p",null,"Another way to collect the code coverage is by using the ",(0,a.kt)("inlineCode",{parentName:"p"},"XPlat Code Coverage")," collector. This will generate a Cobertura xml file."),(0,a.kt)("p",null,"To do that run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},'dotnet test --collect:"XPlat Code Coverage"\n')),(0,a.kt)("p",null,"This command will run our tests and generate a ",(0,a.kt)("inlineCode",{parentName:"p"},"coverage.cobertura.xml")," file that can be found under ",(0,a.kt)("inlineCode",{parentName:"p"},"\\TestResults\\<random-guid>\\coverage.cobertura.xml"),".\nYou can parse and use the this file any way you want but because the Cobertura coverage report is a standardized format, there are tools that can use it to generate reports out of it."),(0,a.kt)("h3",{id:"generating-a-site-to-visualize-code-coverage"},"Generating a site to visualize code coverage"),(0,a.kt)("p",null,"A developer by the name of ",(0,a.kt)("a",{parentName:"p",href:"https://twitter.com/danielpalme"},"Daniel Palme")," has created an excellent tool that can take that Cobertura report xml and generate different types of things out of it.\nOne of them is a website that can help us visualize how our code is covered."),(0,a.kt)("p",null,"To install the tool simply run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},"dotnet tool install -g dotnet-reportgenerator-globaltool\n")),(0,a.kt)("p",null,"Then you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"reportgenerator")," command to create a site out of the file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},'reportgenerator -reports:".\\TestResults\\<the-guid>\\coverage.cobertura.xml" -targetdir:"coverageresults" -reporttypes:Html\n')),(0,a.kt)("p",null,"This will create a ",(0,a.kt)("inlineCode",{parentName:"p"},"coverageresults")," folder. Go into that folder and open the ",(0,a.kt)("inlineCode",{parentName:"p"},"index.html"),"."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(2018).Z,width:"2059",height:"1124"})),(0,a.kt)("p",null,"This is a fully interactive website that you can click on and expand to see exactly how your code is covered."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(100).Z,width:"1646",height:"1262"})))}p.isMDXComponent=!0},5963:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/coverage-62a656addd97aa486bd478993b8775f1.png"},100:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/report-coverage-class-a4911cde53c4b7138613ab6cfa9d6403.png"},2018:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/report-coverage-ffe28ca2af303482fb1360e045929390.png"}}]);