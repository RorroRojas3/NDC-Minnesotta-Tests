"use strict";(self.webpackChunktesting_workshop=self.webpackChunktesting_workshop||[]).push([[1028],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var s=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,s,a=function(e,t){if(null==e)return{};var n,s,a={},r=Object.keys(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=s.createContext({}),m=function(e){var t=s.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=m(e.components);return s.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return s.createElement(s.Fragment,{},t)}},c=s.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=m(n),d=a,h=c["".concat(l,".").concat(d)]||c[d]||u[d]||r;return n?s.createElement(h,o(o({ref:t},p),{},{components:n})):s.createElement(h,o({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var m=2;m<r;m++)o[m]=n[m];return s.createElement.apply(null,o)}return s.createElement.apply(null,n)}c.displayName="MDXCreateElement"},302:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>m});var s=n(7462),a=(n(7294),n(3905));const r={description:"Let's see how we can implement load tests with k6"},o="Load testing",i={unversionedId:"performance-testing/load-testing",id:"performance-testing/load-testing",title:"Load testing",description:"Let's see how we can implement load tests with k6",source:"@site/docs/performance-testing/load-testing.md",sourceDirName:"performance-testing",slug:"/performance-testing/load-testing",permalink:"/performance-testing/load-testing",draft:!1,tags:[],version:"current",frontMatter:{description:"Let's see how we can implement load tests with k6"},sidebar:"docs",previous:{title:"Smoke testing",permalink:"/performance-testing/smoke-testing"},next:{title:"Stress testing",permalink:"/performance-testing/stress-testing"}},l={},m=[{value:"Load testing testing the Customers API",id:"load-testing-testing-the-customers-api",level:2},{value:"Running the simple load test",id:"running-the-simple-load-test",level:2},{value:"Performance thresholds",id:"performance-thresholds",level:3},{value:"Exercise: Write a load test simulating a normal day",id:"exercise-write-a-load-test-simulating-a-normal-day",level:2}],p={toc:m};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,s.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"load-testing"},"Load testing"),(0,a.kt)("p",null,"Load testing's main purpose is to determine the system's ability to handle load both during normal operating condition\nand peak ones. To see how your system behaves during typical load and also during peak load."),(0,a.kt)("p",null,"If, for example, your app handles 20 concurrent users on average as normal load and 50 users during peak hour then you\nwant to run a load test that tests for both numbers in the same execution."),(0,a.kt)("h2",{id:"load-testing-testing-the-customers-api"},"Load testing testing the Customers API"),(0,a.kt)("p",null,"The main code from our Smoke Test, still applies here:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import http from 'k6/http';\nimport { check, sleep} from 'k6';\n\nexport const options = {\n    vus: 1,\n    duration: '1m',\n\n    thresholds: {\n        http_req_duration: ['p(99)<15'], \n    },\n};\n\nconst BASE_URL = 'https://localhost:5001';\n\nexport default () => {\n    const customers = http.get(`${BASE_URL}/customers/`).json();\n    check(customers, { 'retrieved customers': (obj) => obj.customers.length > 0 });\n    sleep(1);\n};\n")),(0,a.kt)("p",null,"What will be changing is that we will no longer have a single stage and a static number of VUs.\nWe will remove ",(0,a.kt)("inlineCode",{parentName:"p"},"vus")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"duration")," from the ",(0,a.kt)("inlineCode",{parentName:"p"},"options")," object and replace them with a stages array."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"stages: [\n    { duration: '5m', target: 50 },\n    { duration: '10m', target: 50 },\n    { duration: '5m', target: 0 },\n]\n")),(0,a.kt)("p",null,"The number of stages for our load test is determined by the number of items in the array."),(0,a.kt)("p",null,"This test reads as follows:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Start the test and for the first 5 minutes simulate ramp-up of traffic from 1 user to 50 over 5 minutes"),(0,a.kt)("li",{parentName:"ol"},"For the next 10 minutes stay are 50 users"),(0,a.kt)("li",{parentName:"ol"},"For the last 5 minutes of the test ramp-down to 0 users")),(0,a.kt)("h2",{id:"running-the-simple-load-test"},"Running the simple load test"),(0,a.kt)("p",null,"Running the load test produces the following results:"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("em",{parentName:"p"},"To save time run with 1 minute ramp-up, 2 minutes sustained and 1 minute ramp-down"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},"          /\\      |\u203e\u203e| /\u203e\u203e/   /\u203e\u203e/\n     /\\  /  \\     |  |/  /   /  /\n    /  \\/    \\    |     (   /   \u203e\u203e\\\n   /          \\   |  |\\  \\ |  (\u203e)  |\n  / __________ \\  |__| \\__\\ \\_____/ .io\n\n  execution: local\n     script: ./load-test.js\n     output: -\n\n  scenarios: (100.00%) 1 scenario, 50 max VUs, 4m30s max duration (incl. graceful stop):\n           * default: Up to 50 looping VUs for 4m0s over 3 stages (gracefulRampDown: 30s, gracefulStop: 30s)\n           \nrunning (4m00.4s), 00/50 VUs, 9001 complete and 0 interrupted iterations\ndefault \u2713 [======================================] 00/50 VUs  4m0s\n\n     \u2713 retrieved customers\n\n     checks.........................: 100.00% \u2713 9001      \u2717 0\n     data_received..................: 2.8 MB  12 kB/s\n     data_sent......................: 418 kB  1.7 kB/s\n     http_req_blocked...............: avg=38.33\xb5s  min=0s       med=0s      max=15.99ms  p(90)=0s      p(95)=0s\n     http_req_connecting............: avg=1.37\xb5s   min=0s       med=0s      max=502.49\xb5s p(90)=0s      p(95)=0s\n   \u2713 http_req_duration..............: avg=933.73\xb5s min=301.39\xb5s med=969\xb5s   max=16.14ms  p(90)=1.24ms  p(95)=1.29ms\n       { expected_response:true }...: avg=933.73\xb5s min=301.39\xb5s med=969\xb5s   max=16.14ms  p(90)=1.24ms  p(95)=1.29ms\n     http_req_failed................: 0.00%   \u2713 0         \u2717 9001\n     http_req_receiving.............: avg=173.1\xb5s  min=0s       med=121.3\xb5s max=542.5\xb5s  p(90)=457.4\xb5s p(95)=499.9\xb5s\n     http_req_sending...............: avg=5.55\xb5s   min=0s       med=0s      max=536.9\xb5s  p(90)=0s      p(95)=0s\n     http_req_tls_handshaking.......: avg=35.64\xb5s  min=0s       med=0s      max=15.5ms   p(90)=0s      p(95)=0s\n     http_req_waiting...............: avg=755.07\xb5s min=200.8\xb5s  med=880.7\xb5s max=15.92ms  p(90)=1ms     p(95)=1ms\n     http_reqs......................: 9001    37.440313/s\n     iteration_duration.............: avg=1s       min=1s       med=1s      max=1.02s    p(90)=1s      p(95)=1s\n     iterations.....................: 9001    37.440313/s\n     vus............................: 1       min=1       max=50\n     vus_max........................: 50      min=50      max=50\n")),(0,a.kt)("p",null,"This is what the traffic graph for this test looks like:"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(3498).Z,width:"800",height:"210"})),(0,a.kt)("p",null,"The benefits of having ramp-up, sustain and ramp-down stages are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"It allows the system to warm up to the users"),(0,a.kt)("li",{parentName:"ul"},"It allows any auto scale to handle the traffic and scale to the new traffic requirements"),(0,a.kt)("li",{parentName:"ul"},"It allows us to compare the response times between the low traffic requests and the high traffic requests")),(0,a.kt)("h3",{id:"performance-thresholds"},"Performance thresholds"),(0,a.kt)("p",null,'You should keep in mind that the thresholds you use to determine a "success" or a "failure" are application specific\nand can go beyond simple ones such as "99% of all requests are successful".'),(0,a.kt)("h2",{id:"exercise-write-a-load-test-simulating-a-normal-day"},"Exercise: Write a load test simulating a normal day"),(0,a.kt)("p",null,"Normal days usually have variable loads. What we want to do is write a load test that simulates that.\nThe use-case below assumes that 20 concurrent users is the normal system traffic."),(0,a.kt)("p",null,"The stages should be:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Simulate ramp-up to 20 users over 5 minutes"),(0,a.kt)("li",{parentName:"ol"},"Stay at 20 users for 10 minutes"),(0,a.kt)("li",{parentName:"ol"},"Simulate ramp-up to 50 users over 3 minutes to simulate increasing traffic"),(0,a.kt)("li",{parentName:"ol"},"Stay at 50 users for 2 minutes to sustain the increased load"),(0,a.kt)("li",{parentName:"ol"},"Simulate ramp-down to 20 users over 3 minutes to simulate decreasing traffic"),(0,a.kt)("li",{parentName:"ol"},"Stay at 20 users for 10 minutes"),(0,a.kt)("li",{parentName:"ol"},"Simulate ramp-down to 0 users")),(0,a.kt)("p",null,"The graph for the test should look as follows:"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(7933).Z,width:"776",height:"209"})))}u.isMDXComponent=!0},7933:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/load-test-2-dfde2b64d38a00a6e3e1e49429bbeb48.jpg"},3498:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/load-test-04c1ae5aaf311b939a52326035fc9613.jpg"}}]);