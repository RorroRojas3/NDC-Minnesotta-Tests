"use strict";(self.webpackChunktesting_workshop=self.webpackChunktesting_workshop||[]).push([[7470],{3905:(e,t,s)=>{s.d(t,{Zo:()=>p,kt:()=>d});var n=s(7294);function r(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function a(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function i(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?a(Object(s),!0).forEach((function(t){r(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):a(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function o(e,t){if(null==e)return{};var s,n,r=function(e,t){if(null==e)return{};var s,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)s=a[n],t.indexOf(s)>=0||(r[s]=e[s]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)s=a[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}var l=n.createContext({}),m=function(e){var t=n.useContext(l),s=t;return e&&(s="function"==typeof e?e(t):i(i({},t),e)),s},p=function(e){var t=m(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var s=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=m(s),d=r,g=c["".concat(l,".").concat(d)]||c[d]||u[d]||a;return s?n.createElement(g,i(i({ref:t},p),{},{components:s})):n.createElement(g,i({ref:t},p))}));function d(e,t){var s=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=s.length,i=new Array(a);i[0]=c;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var m=2;m<a;m++)i[m]=s[m];return n.createElement.apply(null,i)}return n.createElement.apply(null,s)}c.displayName="MDXCreateElement"},9101:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>m});var n=s(7462),r=(s(7294),s(3905));const a={description:"Let's see how we can implement stress tests with k6"},i="Stress testing",o={unversionedId:"performance-testing/stress-testing",id:"performance-testing/stress-testing",title:"Stress testing",description:"Let's see how we can implement stress tests with k6",source:"@site/docs/performance-testing/stress-testing.md",sourceDirName:"performance-testing",slug:"/performance-testing/stress-testing",permalink:"/performance-testing/stress-testing",draft:!1,tags:[],version:"current",frontMatter:{description:"Let's see how we can implement stress tests with k6"},sidebar:"docs",previous:{title:"Load testing",permalink:"/performance-testing/load-testing"},next:{title:"Soak testing",permalink:"/performance-testing/soak-testing"}},l={},m=[{value:"Implementing a stress test",id:"implementing-a-stress-test",level:2},{value:"Results interpretation",id:"results-interpretation",level:3},{value:"Spike Testing",id:"spike-testing",level:2}],p={toc:m};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"stress-testing"},"Stress testing"),(0,r.kt)("p",null,"Stress testing is all about ",(0,r.kt)("strong",{parentName:"p"},"extremes"),". We are trying to see at which point the system will break.\nKnowing when a system fails allows us to know why it failed which in return allows us to see how we can deal with the bottleneck."),(0,r.kt)("p",null,"Is the problem the database? Is it CPU? Is it memory? Is it network bandwidth? Stress testing can answer all these questions."),(0,r.kt)("p",null,"As someone who has worked in e-commerce and in payment, I can tell you that we used to run stress tests all the time.\nThe reason why was because we needed to know how the system would ask in similar situations.\nBlack Friday was the reason why we had to do it in our case. Note that stress testing isn't about instant extreme load.\nThis is Spike Testing, a different flavour of Stress testing, and we will cover it later. In our case, the traffic is gradual but does get extreme."),(0,r.kt)("p",null,"Stress testing our system can tell us:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"How the system will fail (or not fail) during extreme load"),(0,r.kt)("li",{parentName:"ul"},"What is the maximum amount of users or throughput our system can handle before failing"),(0,r.kt)("li",{parentName:"ul"},"What happens once the system fails (for example will the application restart automatically?)")),(0,r.kt)("h2",{id:"implementing-a-stress-test"},"Implementing a stress test"),(0,r.kt)("p",null,"The code for the stress testing is very similar to load testing, however there are two main differences."),(0,r.kt)("p",null,"Firstly, our stages will be broken down to 5 main steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Below normal load"),(0,r.kt)("li",{parentName:"ol"},"Normal load"),(0,r.kt)("li",{parentName:"ol"},"Around considered breaking point"),(0,r.kt)("li",{parentName:"ol"},"Past considered breaking point"),(0,r.kt)("li",{parentName:"ol"},"Recovery stage, ramp-down")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"stages: [\n    { duration: '2m', target: 100 },\n    { duration: '5m', target: 100 },\n    { duration: '2m', target: 200 },\n    { duration: '5m', target: 200 },\n    { duration: '2m', target: 300 },\n    { duration: '5m', target: 300 },\n    { duration: '2m', target: 400 },\n    { duration: '5m', target: 400 },\n    { duration: '10m', target: 0 },\n]\n")),(0,r.kt)("p",null,"Second, we can introducing request batching by using ",(0,r.kt)("inlineCode",{parentName:"p"},"http.batch")," to send multiple requests at once to the system."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const responses = http.batch([\n    ['GET', `${BASE_URL}/customers/`, null],\n    ['GET', `${BASE_URL}/customers/`, null],\n    ['GET', `${BASE_URL}/customers/`, null],\n    ['GET', `${BASE_URL}/customers/`, null],\n]);\n\nresponses.forEach(x => {\n    const customers = x.json();\n    check(customers, { 'retrieved customers': (obj) => obj.customers.length > 0 });\n})\nsleep(1);\n")),(0,r.kt)("p",null,"This is what the results look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-commandline"},"          /\\      |\u203e\u203e| /\u203e\u203e/   /\u203e\u203e/\n     /\\  /  \\     |  |/  /   /  /\n    /  \\/    \\    |     (   /   \u203e\u203e\\\n   /          \\   |  |\\  \\ |  (\u203e)  |\n  / __________ \\  |__| \\__\\ \\_____/ .io\n\n  execution: local\n     script: ./stress-test.js\n     output: -\n\n  scenarios: (100.00%) 1 scenario, 400 max VUs, 7m50s max duration (incl. graceful stop):\n           * default: Up to 400 looping VUs for 7m20s over 9 stages (gracefulRampDown: 30s, gracefulStop: 30s)\n\nrunning (7m20.9s), 000/400 VUs, 99576 complete and 0 interrupted iterations\ndefault \u2713 [======================================] 000/400 VUs  7m20s\n\n     \u2713 retrieved customers\n\n     checks.........................: 100.00% \u2713 398304     \u2717 0\n     data_received..................: 113 MB  256 kB/s\n     data_sent......................: 18 MB   41 kB/s\n     http_req_blocked...............: avg=7.93\xb5s  min=0s      med=0s     max=21.49ms p(90)=0s     p(95)=0s\n     http_req_connecting............: avg=437ns   min=0s      med=0s     max=4ms     p(90)=0s     p(95)=0s\n   \u2713 http_req_duration..............: avg=2.04ms  min=284.5\xb5s med=1.85ms max=29.5ms  p(90)=3.45ms p(95)=3.99ms\n       { expected_response:true }...: avg=2.04ms  min=284.5\xb5s med=1.85ms max=29.5ms  p(90)=3.45ms p(95)=3.99ms\n     http_req_failed................: 0.00%   \u2713 0          \u2717 398304\n     http_req_receiving.............: avg=34.52\xb5s min=0s      med=0s     max=7.89ms  p(90)=44.8\xb5s p(95)=364\xb5s\n     http_req_sending...............: avg=32.9\xb5s  min=0s      med=0s     max=9.49ms  p(90)=0s     p(95)=376.3\xb5s\n     http_req_tls_handshaking.......: avg=7.41\xb5s  min=0s      med=0s     max=20.49ms p(90)=0s     p(95)=0s\n     http_req_waiting...............: avg=1.97ms  min=0s      med=1.66ms max=29ms    p(90)=3.39ms p(95)=3.96ms\n     http_reqs......................: 398304  903.438429/s\n     iteration_duration.............: avg=1s      min=1s      med=1s     max=1.03s   p(90)=1s     p(95)=1s\n     iterations.....................: 99576   225.859607/s\n     vus............................: 3       min=3        max=400\n     vus_max........................: 400     min=400      max=400\n")),(0,r.kt)("p",null,"And this is the chart of what the traffic looks like:"),(0,r.kt)("p",null,(0,r.kt)("img",{src:s(3489).Z,width:"704",height:"245"})),(0,r.kt)("h3",{id:"results-interpretation"},"Results interpretation"),(0,r.kt)("p",null,"We can use the result of our stress test to break down how the system behaved in 4 main way:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Excellent: System performance did not degrade. Response times were similarly load between high and load traffic"),(0,r.kt)("li",{parentName:"ol"},"Good: System performance degraded in terms of response time but all requests were handled sucessfully"),(0,r.kt)("li",{parentName:"ol"},"Poor: System produces error during the spike but recovers during the low-traffic stage"),(0,r.kt)("li",{parentName:"ol"},"Bad: System crashes and doesn't recover even after the traffic is gone.")),(0,r.kt)("h2",{id:"spike-testing"},"Spike Testing"),(0,r.kt)("p",null,"Spike Testing is a type of Stress Testing that aims to overwhelm the system with users immediately and see how the system acts.\nNo warmup time, no ramp-down time. Instant traffic."),(0,r.kt)("p",null,"Examples of such traffic can be the release of items such as iPhones, Steam Decks or new Graphics Cards that make people visit websites and put in orders in the thousands."),(0,r.kt)("p",null,"The stages are usually:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Ramp-up to below normal traffic in 10 seconds"),(0,r.kt)("li",{parentName:"ol"},"Stay there for 1 minute"),(0,r.kt)("li",{parentName:"ol"},"Spike to extreme load (way more than the peak of stress testing) in 10 seconds"),(0,r.kt)("li",{parentName:"ol"},"Stay there for 3 minutes"),(0,r.kt)("li",{parentName:"ol"},"Scale down to below normal load in 10 seconds"),(0,r.kt)("li",{parentName:"ol"},"Stay there for 3 minutes"),(0,r.kt)("li",{parentName:"ol"},"Ramp-down to 0 users in 10 seconds")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"stages: [\n    { duration: '10s', target: 100 },\n    { duration: '1m', target: 100 },\n    { duration: '10s', target: 1400 },\n    { duration: '3m', target: 1400 },\n    { duration: '10s', target: 100 },\n    { duration: '3m', target: 100 },\n    { duration: '10s', target: 0 },\n  ]\n")),(0,r.kt)("p",null,"Here are the results of this test:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-commandline"},"          /\\      |\u203e\u203e| /\u203e\u203e/   /\u203e\u203e/\n     /\\  /  \\     |  |/  /   /  /\n    /  \\/    \\    |     (   /   \u203e\u203e\\\n   /          \\   |  |\\  \\ |  (\u203e)  |\n  / __________ \\  |__| \\__\\ \\_____/ .io\n\n  execution: local\n     script: ./spike-test.js\n     output: -\n\n  scenarios: (100.00%) 1 scenario, 1400 max VUs, 8m10s max duration (incl. graceful stop):\n           * default: Up to 1400 looping VUs for 7m40s over 7 stages (gracefulRampDown: 30s, gracefulStop: 30s)\n\n\nrunning (7m40.5s), 0000/1400 VUs, 290413 complete and 0 interrupted iterations\ndefault \u2713 [======================================] 0000/1400 VUs  7m40s\n\n     \u2713 retrieved customers\n\n     checks.........................: 100.00% \u2713 1161652     \u2717 0\n     data_received..................: 330 MB  717 kB/s\n     data_sent......................: 53 MB   114 kB/s\n     http_req_blocked...............: avg=10.68\xb5s min=0s med=0s     max=41.5ms  p(90)=0s      p(95)=0s\n     http_req_connecting............: avg=661ns   min=0s med=0s     max=18.5ms  p(90)=0s      p(95)=0s\n   \u2713 http_req_duration..............: avg=4.22ms  min=0s med=3.5ms  max=50.99ms p(90)=7.99ms  p(95)=9.99ms\n       { expected_response:true }...: avg=4.22ms  min=0s med=3.5ms  max=50.99ms p(90)=7.99ms  p(95)=9.99ms\n     http_req_failed................: 0.00%   \u2713 0           \u2717 1161652\n     http_req_receiving.............: avg=33.6\xb5s  min=0s med=0s     max=38.69ms p(90)=0s      p(95)=498.2\xb5s\n     http_req_sending...............: avg=50.89\xb5s min=0s med=0s     max=32ms    p(90)=211.1\xb5s p(95)=499.7\xb5s\n     http_req_tls_handshaking.......: avg=9.81\xb5s  min=0s med=0s     max=40.99ms p(90)=0s      p(95)=0s\n     http_req_waiting...............: avg=4.14ms  min=0s med=3.49ms max=50.99ms p(90)=7.99ms  p(95)=9.5ms\n     http_reqs......................: 1161652 2522.818842/s\n     iteration_duration.............: avg=1s      min=1s med=1s     max=1.06s   p(90)=1.01s   p(95)=1.01s\n     iterations.....................: 290413  630.704711/s\n     vus............................: 6       min=6         max=1400\n     vus_max........................: 1400    min=1400      max=1400\n")),(0,r.kt)("p",null,"And here is the graph of the traffic:"),(0,r.kt)("p",null,(0,r.kt)("img",{src:s(5984).Z,width:"800",height:"227"})))}u.isMDXComponent=!0},5984:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/spike-test-be00e9f9485759d4d3bf216efffabde5.jpg"},3489:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/stress-test-c78481cd54399eeda30938cdf72075d6.jpg"}}]);