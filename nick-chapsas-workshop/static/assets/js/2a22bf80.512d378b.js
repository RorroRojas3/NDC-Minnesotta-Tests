"use strict";(self.webpackChunktesting_workshop=self.webpackChunktesting_workshop||[]).push([[3940],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>g});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),u=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=u(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=u(n),g=o,y=d["".concat(c,".").concat(g)]||d[g]||p[g]||a;return n?r.createElement(y,i(i({ref:t},l),{},{components:n})):r.createElement(y,i({ref:t},l))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5740:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=n(7462),o=(n(7294),n(3905));const a={description:"Let's try to write a test"},i="Trying to write a test",s={unversionedId:"unit-testing/deep-dive/attempting-test",id:"unit-testing/deep-dive/attempting-test",title:"Trying to write a test",description:"Let's try to write a test",source:"@site/docs/unit-testing/deep-dive/attempting-test.md",sourceDirName:"unit-testing/deep-dive",slug:"/unit-testing/deep-dive/attempting-test",permalink:"/unit-testing/deep-dive/attempting-test",draft:!1,tags:[],version:"current",frontMatter:{description:"Let's try to write a test"},sidebar:"docs",previous:{title:"The QuoteService",permalink:"/unit-testing/deep-dive/quote-service"},next:{title:"Introducing Mocking",permalink:"/unit-testing/deep-dive/mocking-intro"}},c={},u=[],l={toc:u};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"trying-to-write-a-test"},"Trying to write a test"),(0,o.kt)("p",null,'We can use everything we learned in the Getting Started section to write our first "happy path" test for the ',(0,o.kt)("inlineCode",{parentName:"p"},"GetQuoteAsync")," method."),(0,o.kt)("p",null,"The test name would be ",(0,o.kt)("inlineCode",{parentName:"p"},"GetQuoteAsync_ReturnsQuote_WhenCurrenciesAreValid")," and would look like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp",metastring:'title="QuoteServiceTests.cs"',title:'"QuoteServiceTests.cs"'},'\npublic class QuoteServiceTests\n{\n    private readonly QuoteService _sut;\n    private readonly IRatesRepository _ratesRepository = new RatesRepository(new NpgsqlConnectionFactory("Server=localhost;Port=5432;Database=mydb;User ID=workshop;Password=changeme;"));\n    private readonly ILogger<QuoteService> _logger = new NullLogger<QuoteService>();\n\n    public QuoteServiceTests()\n    {\n        _sut = new(_ratesRepository, _logger);\n    }\n    \n    [Fact]\n    public async Task GetQuoteAsync_ReturnsQuote_WhenCurrenciesAreValid()\n    {\n        // Arrange\n        var fromCurrency = "GBP";\n        var toCurrency = "USD";\n        var amount = 100;\n    \n        var expectedQuote = new ConversionQuote\n        {\n            BaseCurrency = fromCurrency,\n            QuoteCurrency = toCurrency,\n            BaseAmount = amount,\n            QuoteAmount = 160\n        };\n        \n        // Act\n        var quote = await _sut.GetQuoteAsync(fromCurrency, toCurrency, amount);\n    \n        // Assert\n        quote!.Should().BeEquivalentTo(expectedQuote);\n    }    \n}\n')),(0,o.kt)("p",null,"However, this test is pretty...weird. We don't really arrange what data will be returned.\nOn top of that, even if you assert against a value that matches the rate that the database contains, the rate can change at any time, making the test fail."),(0,o.kt)("p",null,"If I try to run the test in my workstation this is the response I get:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"Npgsql.NpgsqlException: Failed to connect to 127.0.0.1:5432\n\nNpgsql.NpgsqlException\nFailed to connect to 127.0.0.1:5432\n   at Npgsql.Internal.NpgsqlConnector.ConnectAsync(NpgsqlTimeout timeout, CancellationToken cancellationToken)\n")),(0,o.kt)("p",null,"This is because the database isn't running on my workstation, and there is no way for us to guarantee that everyone who will ever run these unit test will have a database running."),(0,o.kt)("p",null,"On top of that, testing the database integration is out of scope. We don't really care about it at all. All we want to do is assume that the database responds fine and then test our own code."),(0,o.kt)("p",null,"We can solve that problem by introducing ",(0,o.kt)("strong",{parentName:"p"},"Mocking"),"."))}p.isMDXComponent=!0}}]);