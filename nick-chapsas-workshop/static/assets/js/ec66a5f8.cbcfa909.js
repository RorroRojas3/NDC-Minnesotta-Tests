"use strict";(self.webpackChunktesting_workshop=self.webpackChunktesting_workshop||[]).push([[9342],{3905:(t,e,n)=>{n.d(e,{Zo:()=>c,kt:()=>h});var r=n(7294);function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,r,a=function(t,e){if(null==t)return{};var n,r,a={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}var l=r.createContext({}),u=function(t){var e=r.useContext(l),n=e;return t&&(n="function"==typeof t?t(e):s(s({},e),t)),n},c=function(t){var e=u(t.components);return r.createElement(l.Provider,{value:e},t.children)},d={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},p=r.forwardRef((function(t,e){var n=t.components,a=t.mdxType,i=t.originalType,l=t.parentName,c=o(t,["components","mdxType","originalType","parentName"]),p=u(n),h=a,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||i;return n?r.createElement(m,s(s({ref:e},c),{},{components:n})):r.createElement(m,s({ref:e},c))}));function h(t,e){var n=arguments,a=e&&e.mdxType;if("string"==typeof t||a){var i=n.length,s=new Array(i);s[0]=p;var o={};for(var l in e)hasOwnProperty.call(e,l)&&(o[l]=e[l]);o.originalType=t,o.mdxType="string"==typeof t?t:a,s[1]=o;for(var u=2;u<i;u++)s[u]=n[u];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5398:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const i={description:"Time to run our first mutation tests"},s="Let's run some Mutation Tests",o={unversionedId:"mutation-testing/hands-on",id:"mutation-testing/hands-on",title:"Let's run some Mutation Tests",description:"Time to run our first mutation tests",source:"@site/docs/mutation-testing/hands-on.md",sourceDirName:"mutation-testing",slug:"/mutation-testing/hands-on",permalink:"/mutation-testing/hands-on",draft:!1,tags:[],version:"current",frontMatter:{description:"Time to run our first mutation tests"},sidebar:"docs",previous:{title:"What is mutation testing?",permalink:"/mutation-testing/"},next:{title:"Exercise: Kill all the mutants!",permalink:"/mutation-testing/exercise"}},l={},u=[{value:"The calculator class",id:"the-calculator-class",level:2},{value:"Running our first mutation test",id:"running-our-first-mutation-test",level:2}],c={toc:u};function d(t){let{components:e,...i}=t;return(0,a.kt)("wrapper",(0,r.Z)({},c,i,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"lets-run-some-mutation-tests"},"Let's run some Mutation Tests"),(0,a.kt)("h2",{id:"the-calculator-class"},"The calculator class"),(0,a.kt)("p",null,"Consider the following calculator class:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"public class Calculator\n{\n    public int Add(int first, int second)\n    {\n        return first + second;\n    }\n\n    public int Subtract(int first, int second)\n    {\n        return first - second;\n    }\n\n    public int Multiply(int first, int second)\n    {\n        return first * second;\n    }\n\n    public (int Result, int Remainder) Divide(int first, int second)\n    {\n        if (second == 0)\n        {\n            throw new DivideByZeroException();\n        }\n        \n        var result = first / second;\n        var remainder = first % second;\n        return (result, remainder);\n    }\n}\n")),(0,a.kt)("p",null,"It is a bit different than the one we saw in the introduction but it has mostly the same functionality."),(0,a.kt)("p",null,"Because we are good developers we wrote unit tests for this calculator:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"public class CalculatorTests\n{\n    [Theory]\n    [InlineData(5, 5, 10)]\n    public void Test_Add(int first, int second, int expected)\n    {\n        // Arrange\n        var sut = new Calculator();\n\n        // Act\n        var result = sut.Add(first, second);\n\n        // Assert\n        result.Should().Be(expected);\n    }\n\n    [Theory]\n    [InlineData(5, 5, 0)]\n    public void Test_Subtract(int first, int second, int expected)\n    {\n        // Arrange\n        var sut = new Calculator();\n        \n        // Act\n        var result = sut.Subtract(first, second);\n\n        // Assert\n        result.Should().Be(expected);\n    }\n\n    [Theory]\n    [InlineData(1, 1, 1)]\n    public void Test_Multiply(int first, int second, int expected)\n    {\n        // Arrange\n        var sut = new Calculator();\n        \n        // Act\n        var result = sut.Multiply(first, second);\n\n        // Assert\n        result.Should().Be(expected);\n    }\n\n    [Theory]\n    [InlineData(1, 1, 1, 0)]\n    public void Test_Divide(int first, int second, int expected, int remainder)\n    {\n        // Arrange\n        var sut = new Calculator();\n        \n        // Act\n        var result = sut.Divide(first, second);\n\n        // Assert\n        result.Result.Should().Be(expected);\n        result.Remainder.Should().Be(remainder);\n    }\n\n    [Fact]\n    public void Test_Divide_ByZero()\n    {\n        // Arrange\n        var sut = new Calculator();\n\n        // Act\n        var result = () => sut.Divide(1, 0);\n        \n        // Assert\n        result.Should().Throw<DivideByZeroException>();\n    }\n}\n")),(0,a.kt)("p",null,"Running code coverage collection for these tests reveals that our code is 100% covered. "),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(7068).Z,width:"805",height:"502"})),(0,a.kt)("p",null,"Amazing right? ",(0,a.kt)("em",{parentName:"p"},"Well...")),(0,a.kt)("h2",{id:"running-our-first-mutation-test"},"Running our first mutation test"),(0,a.kt)("p",null,"In order to run mutation tests we first need to install the Stryker.NET command line too.\nIt can be installed either as a project specific tool or as a global tool. In this example we will install it as a global tool."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},"dotnet tool install -g dotnet-stryker\n")),(0,a.kt)("p",null,"Now all we need to do is to be on the test project director of whichever tests we want to run mutation tests against and run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-commandline"},"dotnet stryker\n")),(0,a.kt)("p",null,"Stryker.NET will kick in and do its thing. In the end it will generate a report in the for of a site."),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(781).Z,width:"1346",height:"1075"})),(0,a.kt)("p",null,"Before we look at the report there are a few interesting metrics in the console."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"12 mutants created: This means that Stryker.NET was able to create 12 different variations of our codebase to run our existing tests against"),(0,a.kt)("li",{parentName:"ul"},"Killed 7: This means that 7 of the mutations made our tests fail which is good because they should fail when the code changes"),(0,a.kt)("li",{parentName:"ul"},"Survived 5: This means that 5 of the mutations didn't manage to make our tests fail. When our tests pass on mutated code it means that they aren't good"),(0,a.kt)("li",{parentName:"ul"},"The final mutation score is 58.33%: Mutation score is the percentage of killed mutants divided by the total number of mutants multiplied by 100. The higher the percentage the better")),(0,a.kt)("p",null,"Let's take a look at the Stryker.NET report"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(9883).Z,width:"2514",height:"924"})),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(4970).Z,width:"1468",height:"1222"})),(0,a.kt)("p",null,"In the generated report, Stryker let's us know exactly which mutation survived and why it did.\nIn the example above, the mutant survived because in our test, we only test subtraction that leads to the result ",(0,a.kt)("inlineCode",{parentName:"p"},"0"),".\nThis leads to Stryker applied one of its mutations which is to replace ",(0,a.kt)("inlineCode",{parentName:"p"},"first - second")," with ",(0,a.kt)("inlineCode",{parentName:"p"},"0")," and the test still passes, when it shouldn't."),(0,a.kt)("p",null,"We can fix that by adding an extra test or test case that checks for a different number as a result of the subtraction. "),(0,a.kt)("p",null,"For example ",(0,a.kt)("inlineCode",{parentName:"p"},"10-9=1"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"[Theory]\n[InlineData(5, 5, 0)]\n// highlight-next-line\n[InlineData(10, 9, 1)]\npublic void Test_Subtract(int first, int second, int expected)\n")),(0,a.kt)("p",null,"This will fix our problem:"),(0,a.kt)("p",null,(0,a.kt)("img",{src:n(9927).Z,width:"1441",height:"734"})),(0,a.kt)("p",null,"Note here that our code coverage is still 100% but we now have a more robust set of tests."))}d.isMDXComponent=!0},7068:(t,e,n)=>{n.d(e,{Z:()=>r});const r=n.p+"assets/images/mutation-coverage-bd7feab7a969e6ca2a717a1ac3b2c9f4.png"},9883:(t,e,n)=>{n.d(e,{Z:()=>r});const r=n.p+"assets/images/stryker-1-411a5832fd15b0ff2385aa29a1d729c2.png"},4970:(t,e,n)=>{n.d(e,{Z:()=>r});const r=n.p+"assets/images/stryker-2-6d3e20929d6061ac0a1b83804d377290.png"},9927:(t,e,n)=>{n.d(e,{Z:()=>r});const r=n.p+"assets/images/stryker-3-4162d27a90f3c6c7a415249e69963e00.png"},781:(t,e,n)=>{n.d(e,{Z:()=>r});const r=n.p+"assets/images/stryker-results-8c058dba7ed79c35ea117be78223b80f.png"}}]);